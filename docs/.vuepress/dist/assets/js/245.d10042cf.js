(window.webpackJsonp=window.webpackJsonp||[]).push([[245],{709:function(t,a,s){"use strict";s.r(a);var e=s(25),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[t._v("#")]),t._v(" docker-compose")]),t._v(" "),a("h2",{attrs:{id:"docker-compose-yml-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-yml-配置"}},[t._v("#")]),t._v(" docker-compose.yml 配置")]),t._v(" "),a("p",[a("code",[t._v("docker-compose")]),t._v(" 是一个用于定义和运行多容器 Docker 应用的工具。它使用 YAML 文件来配置应用的服务、网络和卷等。接下来，我将详细介绍 "),a("code",[t._v("docker-compose.yml")]),t._v(" 文件中的常用配置项，并提供相应的示例。")]),t._v(" "),a("h3",{attrs:{id:"基本配置项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本配置项"}},[t._v("#")]),t._v(" 基本配置项")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("version")]),t._v(": 定义 "),a("code",[t._v("docker-compose")]),t._v(" 文件的版本。新的 docker-compose 不需要显示指定")]),t._v(" "),a("li",[a("strong",[t._v("services")]),t._v(": 定义应用中所有的服务。")]),t._v(" "),a("li",[a("strong",[t._v("networks")]),t._v(": 定义网络配置。")]),t._v(" "),a("li",[a("strong",[t._v("volumes")]),t._v(": 定义数据卷，用于数据持久化。")])]),t._v(" "),a("h3",{attrs:{id:"服务级别的配置项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务级别的配置项"}},[t._v("#")]),t._v(" 服务级别的配置项")]),t._v(" "),a("h4",{attrs:{id:"_1-image"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-image"}},[t._v("#")]),t._v(" 1. image")]),t._v(" "),a("p",[t._v("指定要使用的 Docker 镜像，可以是官方镜像或自定义镜像。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n")])])]),a("h4",{attrs:{id:"_2-build"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-build"}},[t._v("#")]),t._v(" 2. build")]),t._v(" "),a("p",[t._v("定义如何构建 Docker 镜像。可以指定构建上下文和 Dockerfile 的路径。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./app\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dockerfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Dockerfile\n")])])]),a("h4",{attrs:{id:"_3-container-name"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-container-name"}},[t._v("#")]),t._v(" 3. container_name")]),t._v(" "),a("p",[t._v("为容器指定一个自定义名称。")]),t._v(" "),a("p",[t._v("指定容器名称，但是指定后不能够横向扩展，往往不会用到")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my_nginx\n")])])]),a("h4",{attrs:{id:"_4-ports"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-ports"}},[t._v("#")]),t._v(" 4. ports")]),t._v(" "),a("p",[t._v("定义主机与容器之间的端口映射。")]),t._v(" "),a("p",[t._v("在 trafik 代理下往往不需要指定。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'8080:80'")]),t._v("\n")])])]),a("h4",{attrs:{id:"_5-environment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-environment"}},[t._v("#")]),t._v(" 5. environment")]),t._v(" "),a("p",[t._v("设置环境变量。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" NODE_ENV=production\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" API_KEY=abcdef\n")])])]),a("h4",{attrs:{id:"_6-volumes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-volumes"}},[t._v("#")]),t._v(" 6. volumes")]),t._v(" "),a("p",[t._v("定义数据卷的挂载。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/www/html\n")])])]),a("h4",{attrs:{id:"_7-networks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-networks"}},[t._v("#")]),t._v(" 7. networks")]),t._v(" "),a("p",[t._v("指定服务所属的网络。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" frontend\n")])])]),a("h4",{attrs:{id:"_8-depends-on"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-depends-on"}},[t._v("#")]),t._v(" 8. depends_on")]),t._v(" "),a("p",[t._v("定义服务之间的依赖关系，确保某些服务在其他服务启动之前启动。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" db\n")])])]),a("h4",{attrs:{id:"_9-restart"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-restart"}},[t._v("#")]),t._v(" 9. restart")]),t._v(" "),a("p",[t._v("设置容器的重启策略（no, on-failure, always, unless-stopped）。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n")])])]),a("h4",{attrs:{id:"_10-command"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-command"}},[t._v("#")]),t._v(" 10. command")]),t._v(" "),a("p",[t._v("覆盖镜像的默认命令。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'start'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h4",{attrs:{id:"_11-entrypoint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-entrypoint"}},[t._v("#")]),t._v(" 11. entrypoint")]),t._v(" "),a("p",[t._v("覆盖镜像的默认入口点。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("entrypoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/local/bin/start.sh\n")])])]),a("h4",{attrs:{id:"_12-expose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-expose"}},[t._v("#")]),t._v(" 12. expose")]),t._v(" "),a("p",[t._v("只暴露容器内部的端口，不映射到主机上。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("expose")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3000'")]),t._v("\n")])])]),a("h4",{attrs:{id:"_13-env-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-env-file"}},[t._v("#")]),t._v(" 13. env_file")]),t._v(" "),a("p",[t._v("从文件中读取环境变量。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env_file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" .env\n")])])]),a("h4",{attrs:{id:"_14-labels"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-labels"}},[t._v("#")]),t._v(" 14. labels")]),t._v(" "),a("p",[t._v("用于为容器、服务或网络等资源添加元数据。这些标签可以帮助标识和管理容器，支持多种用途，包括监控、调试和自动化管理。例如可以筛选容器，在结合 traefik 或者 k8s 使用时，用以控制流量")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" com.example.description"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Accounting webapp"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" com.example.department"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Finance"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" com.example.label"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("with"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("empty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.example.environment=production"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.example.department=marketing"')]),t._v("\n")])])]),a("p",[t._v("com.example.environment=production：表示这个服务运行在生产环境中。")]),t._v(" "),a("p",[t._v("com.example.department=marketing：表示这个服务属于营销部门。")]),t._v(" "),a("p",[t._v("这些标签可以用于：")]),t._v(" "),a("ul",[a("li",[t._v("识别和管理：通过标签可以快速识别容器的用途、所属部门或环境。")]),t._v(" "),a("li",[t._v("自动化工具：许多自动化工具和平台（如 Kubernetes、监控系统）可以读取标签，以便执行特定操作。")]),t._v(" "),a("li",[t._v("文档化：为其他开发人员和运维人员提供关于容器的额外信息。")])]),t._v(" "),a("h3",{attrs:{id:"网络和卷的配置项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络和卷的配置项"}},[t._v("#")]),t._v(" 网络和卷的配置项")]),t._v(" "),a("h4",{attrs:{id:"networks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#networks"}},[t._v("#")]),t._v(" networks")]),t._v(" "),a("p",[t._v("定义网络配置，如驱动类型、子网和 IP 范围。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("frontend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bridge\n")])])]),a("h4",{attrs:{id:"volumes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#volumes"}},[t._v("#")]),t._v(" volumes")]),t._v(" "),a("p",[t._v("定义数据卷的配置。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data-volume")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" local\n")])])]),a("h3",{attrs:{id:"完整的-docker-compose-yml-示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#完整的-docker-compose-yml-示例"}},[t._v("#")]),t._v(" 完整的 "),a("code",[t._v("docker-compose.yml")]),t._v(" 示例")]),t._v(" "),a("p",[t._v("以下是一个实际的 "),a("code",[t._v("docker-compose.yml")]),t._v(" 文件示例，展示了如何组合以上配置项来定义一个简单的应用。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.9'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx_server\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'8080:80'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./nginx.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/nginx/nginx.conf\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" frontend\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" db\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" NGINX_PORT=80\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("db")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.7")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql_database\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" MYSQL_ROOT_PASSWORD=example\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" MYSQL_DATABASE=mydb\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" backend\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("frontend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bridge\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bridge\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("db-data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" local\n")])])]),a("h3",{attrs:{id:"解释"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解释"}},[t._v("#")]),t._v(" 解释")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("version")]),t._v(": 指定 "),a("code",[t._v("docker-compose")]),t._v(" 文件使用的版本。")]),t._v(" "),a("li",[a("strong",[t._v("services")]),t._v(": 定义了两个服务："),a("code",[t._v("web")]),t._v(" 和 "),a("code",[t._v("db")]),t._v("。\n"),a("ul",[a("li",[a("strong",[t._v("web")]),t._v(" 服务：使用 "),a("code",[t._v("nginx")]),t._v(" 镜像，暴露端口 8080 映射到容器的 80 端口，挂载本地的 "),a("code",[t._v("nginx.conf")]),t._v(" 配置文件到容器的 "),a("code",[t._v("/etc/nginx/nginx.conf")]),t._v("，使用 "),a("code",[t._v("frontend")]),t._v(" 网络，并依赖于 "),a("code",[t._v("db")]),t._v(" 服务。")]),t._v(" "),a("li",[a("strong",[t._v("db")]),t._v(" 服务：使用 "),a("code",[t._v("mysql")]),t._v(" 镜像，设置环境变量以初始化数据库，挂载数据卷 "),a("code",[t._v("db-data")]),t._v("，使用 "),a("code",[t._v("backend")]),t._v(" 网络。")])])]),t._v(" "),a("li",[a("strong",[t._v("networks")]),t._v(": 定义了两个网络："),a("code",[t._v("frontend")]),t._v(" 和 "),a("code",[t._v("backend")]),t._v("，都使用桥接网络驱动。")]),t._v(" "),a("li",[a("strong",[t._v("volumes")]),t._v(": 定义了一个本地驱动的数据卷 "),a("code",[t._v("db-data")]),t._v("，用于持久化 MySQL 数据。")])]),t._v(" "),a("p",[t._v("通过这些配置，"),a("code",[t._v("docker-compose")]),t._v(" 能够轻松地管理多容器应用的启动、停止和整体操作。")]),t._v(" "),a("h2",{attrs:{id:"docker-compose-命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-命令"}},[t._v("#")]),t._v(" docker-compose 命令")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 启动\n$ docker-compose up --build xxx -d\n\n# 查看日志\n$ docker-compose logs\n\n# 停止\n$ docker-compose stop\n\n# 删除\n$ docker-compose rm\n")])])]),a("p",[t._v("使用 docker-compose up 启动容器，它会自动查找当前目录下的 docker-compose.yaml 文件作为配置文件")]),t._v(" "),a("h2",{attrs:{id:"扩展"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩展"}},[t._v("#")]),t._v(" 扩展")]),t._v(" "),a("h3",{attrs:{id:"version-字段的历史进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#version-字段的历史进程"}},[t._v("#")]),t._v(" version 字段的历史进程")]),t._v(" "),a("p",[t._v("在 Docker Compose 的历史上，"),a("code",[t._v("version")]),t._v(" 字段曾经是 "),a("code",[t._v("docker-compose.yml")]),t._v(" 文件中一个重要的部分，用于指定 Compose 文件的格式版本。随着 Docker Compose 的发展，"),a("code",[t._v("version")]),t._v(" 字段的角色和重要性也发生了变化。")]),t._v(" "),a("h4",{attrs:{id:"version-字段的历史进程-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#version-字段的历史进程-2"}},[t._v("#")]),t._v(" "),a("code",[t._v("version")]),t._v(" 字段的历史进程")]),t._v(" "),a("ol",[a("li",[a("p",[a("strong",[t._v("早期版本（1.x 和 2.x）")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("在这些版本中，"),a("code",[t._v("version")]),t._v(" 字段用于指示 "),a("code",[t._v("docker-compose.yml")]),t._v(" 文件的格式版本，不同的格式版本支持不同的功能和语法。")]),t._v(" "),a("li",[t._v("例如，"),a("code",[t._v("version: '2'")]),t._v(" 引入了更复杂的网络和卷配置，而 "),a("code",[t._v("version: '2.1'")]),t._v(" 等后续版本则逐步增加了更细化的控制能力。")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("3.x 版本")]),t._v("：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("version: '3'")]),t._v(" 及其子版本（如 "),a("code",[t._v("3.1")]),t._v("、"),a("code",[t._v("3.2")]),t._v(" 等）主要为了支持 Docker Swarm 模式，提供了更丰富的集群管理功能。")]),t._v(" "),a("li",[t._v("这些版本继续发展，增加了对增强的资源限制、部署策略等功能的支持。")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Compose V2（当前版本）")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("随着 Docker Compose V2 的推出，"),a("code",[t._v("version")]),t._v(" 字段的使用变得更加灵活。Compose V2 通过检测 Compose 文件的内容和 Docker 引擎版本来自动确定支持的功能，而不是依赖显式的 "),a("code",[t._v("version")]),t._v(" 字段。")]),t._v(" "),a("li",[t._v("在最新的 Docker Compose 中，"),a("code",[t._v("version")]),t._v(" 字段变得可选，默认情况下不需要显式指定。Docker Compose 会根据 Docker 引擎的功能自动适配。")])])])]),t._v(" "),a("h4",{attrs:{id:"现代实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#现代实践"}},[t._v("#")]),t._v(" 现代实践")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("无需指定 "),a("code",[t._v("version")])]),t._v("：在现代 Docker Compose 实践中，"),a("code",[t._v("version")]),t._v(" 字段通常可以忽略，尤其是在使用最新的 Docker Compose CLI 时。")]),t._v(" "),a("li",[a("strong",[t._v("向后兼容")]),t._v("：如果你的项目需要向后兼容，或者在一个较老的 Docker 环境中运行，仍然可以指定 "),a("code",[t._v("version")]),t._v("，以确保兼容性。")])])])}),[],!1,null,null,null);a.default=n.exports}}]);